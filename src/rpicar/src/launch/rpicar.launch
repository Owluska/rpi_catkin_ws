<launch>
 	<!-- battery, IMU & US drivers for ROS -->
  <node pkg="rpicar" type="battery_talker.py" name="battery"/>
	<node pkg="rpicar" type="IMU_talker.py" name="imu"/> 
  <node pkg="rpicar" type="US_talker.py" name="US1">
  		<param name="US_number" value="1"/>
  </node>
  <node pkg="rpicar" type="US_talker.py" name="US2">
  		<param name="US_number" value="2"/>
  </node>
	
	<!-- <node pkg="cv_camera" type="cv_camera_node"  name="right">
  		<param name = "device_id" value="0"/>
  	</node> -->


  <arg name="cam_id" default="1"/>
  <arg name="viewer" default="false" />

  <arg name="manager" /> <!-- Must be globally qualified -->
  <arg name="respawn" default="false" />

  <arg     if="$(arg respawn)" name="bond" value="" />
  <arg unless="$(arg respawn)" name="bond" value="--no-bond" />

  <node name="usb_cam" pkg="usb_cam" type="usb_cam_node" output="screen" >
    <param name="video_device" value="/dev/video$(arg cam_id)" />
    <param name="image_width" value="640" />
    <param name="image_height" value="480" />
    <param name="pixel_format" value="yuyv" />
    <param name="camera_frame_id" value="usb_cam" />
    <param name="io_method" value="mmap"/>
  </node>

  <group if="$(arg viewer)">
    <node name="image_view" pkg="image_view" type="image_view" respawn="false" output="screen">
      <remap from="image" to="/usb_cam/image_raw"/>
      <param name="autosize" value="true" />
    </node>
  </group>

  <!-- Load image_proc node: -->
    <group ns="usb_cam">
      <node name="image_proc" pkg="image_proc" type="image_proc"/>
    </group>
	
	<node pkg="cv_camera" type="cv_camera_node"  name="right">
  		<param name = "device_id" value="0"/>
  	</node>
  	<!-- <node pkg="rpicar" type="camera_talker.py" name="left_camera">
  		<param name="camera" value="2"/>
  	</node>
  	<node pkg="rpicar" type="camera_talker.py" name="right_camera">
  		<param name="camera" value="0"/> 
  	</node>-->
	<rosparam param="imu0_config"> [true,true,false,false,false,true,true,true,false,false,false,true,true,true,true] </rosparam>
	<node pkg="robot_pose_ekf" type="robot_pose_ekf" name="robot_pose_ekf">
		<param name="output_frame" value="odom_combined"/>
		<param name="base_footprint_frame" value="base_footprint"/>
		<param name="freq" value="30.0"/>
		<param name="sensor_timeout" value="1.0"/>  
		<param name="odom_used" value="false"/>
		<param name="imu_used" value="true"/>
		<param name="vo_used" value="false"/>

		<param name="imu0" value="/imu_data"/>
		<remap from="odom" to="pr2_base_odometry/odom" />
	</node>  
</launch>

